name: ğŸ—ï¸ Build

on:
  push:
    branches:
      - main
      - github-actions

jobs:
  build:
    strategy:
      matrix:
        build_image:
          - "ubuntu-24.04"
          - "ubuntu-24.04-arm"
        alpine:
         - "3.21"
        php:
          - "8.4"
    runs-on: ${{ matrix.build_image }}
    steps:
      - name: â†™ï¸ Checkout
        uses: actions/checkout@v4
        with:
          show-progress: false

      - name: ğŸ”‘ Generate keys
        run: make keys

      - name: ğŸ—ï¸  Build
        run: |
          ARCH=$(uname -m)
          echo "Building alpine ${{ matrix.alpine }} php ${{ matrix.php }} arch ${ARCH}"
          make build ARCH=${ARCH} ALPINE=${{ matrix.alpine }} PHP=${{ matrix.php }}


make build ARCH=${ARCH} ALPINE=<< parameters.alpine >> PHP=<< parameters.php >>