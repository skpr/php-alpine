# Maintainer: Nick Schuch <nick.schuch@skpr.io>

pkgname=php8.5-compass
_pkgreal=compass
pkgver=0.0.1
pkgrel=1
provides="php-compass=8.5"
pkgdesc="Compass - Probes for instrumenting PHP applications"
url="https://github.com/skpr/compass-extension"
arch="all"
license="PHP-3"
depends="php8.5-common>=8.5.0 php8.5-common<8.6.0"
makedepends="php8.5-dev>=8.5.0 php8.5-dev<8.6.0 autoconf alpine-sdk clang clang-dev mise"
source="php-compass-$pkgver.tar.gz::https://github.com/skpr/compass-extension/archive/refs/tags/v0.0.1.tar.gz"
builddir="$srcdir/compass-extension-0.0.1"

prepare() {
	default_prepare || return 1
}

build() {
	cd "$builddir"
	mise trust
    mise build
}

package() {
	mkdir -p "$pkgdir"
    cp ${builddir}/00_compass.ini ${pkgdir}/etc/php/conf.d/00_compass.ini
    cp ${builddir}/target/release/libcompass_extension.so ${pkgdir}/usr/lib/php/modules/compass.so
}

sha512sums="
03513a6f3d223f29f118d75fc5c89ed92054fb6f0ea91cfe85354462bdce4b57adaffcc7d02695b6723cff3fc1102deedccfd40425e693099fc7d3c5e7e871ba  php-c-0.4.22.tar.gz
"
